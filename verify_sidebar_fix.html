<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Sidebar Dropdown Fix</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Sidebar CSS from your project (simplified) -->
    <style>
        body { background: #f8f9fc; }
        #wrapper { display: flex; min-height: 100vh; }
        
        #sidebar-container {
            width: 250px;
            background: #23272b;
            color: #fff;
            min-height: 100vh;
            overflow-y: auto;
        }
        
        .sidebar .nav-link {
            color: #fff;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-left: 4px solid transparent;
            text-decoration: none;
            transition: all 0.2s ease;
        }
        
        .sidebar .nav-link:hover {
            background: #1a1d21;
            color: #00bfff;
            border-left-color: #00bfff;
        }
        
        .sidebar .nav-link::after {
            content: '\f105';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            transition: transform 0.3s ease;
            float: right;
            margin-left: auto;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .sidebar .nav-link.expanded::after,
        .sidebar .nav-link[aria-expanded="true"]::after {
            content: '\f107';
            transform: rotate(90deg);
        }
        
        .collapse {
            display: none;
        }
        
        .collapse.show {
            display: block;
        }
        
        .collapse-inner {
            background: #343a40;
            padding: 5px 0;
            margin: 0 10px;
            border-radius: 4px;
        }
        
        .collapse-item {
            display: block;
            padding: 8px 15px;
            color: #e9ecef;
            text-decoration: none;
            font-size: 0.9rem;
            margin: 2px 5px;
            border-radius: 3px;
            transition: all 0.2s;
        }
        
        .collapse-item:hover {
            background: #495057;
            color: #00bfff;
        }
        
        #content-wrapper {
            flex: 1;
            padding: 20px;
        }
        
        .status-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .test-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-entry { margin: 2px 0; }
        .log-entry.open { color: #28a745; }
        .log-entry.close { color: #dc3545; }
        .log-entry.click { color: #007bff; }
        .log-entry.error { color: #dc3545; font-weight: bold; }
        
        .btn-test {
            margin: 5px;
        }
    </style>
</head>
<body>
    <div id="wrapper">
        <!-- Test Sidebar -->
        <div id="sidebar-container" class="sidebar">
            <div class="p-3">
                <h5 class="text-center mb-4">Test Sidebar</h5>
            </div>
            
            <div class="nav-item">
                <a class="nav-link" href="#" data-bs-toggle="collapse" data-bs-target="#test1">
                    <span><i class="fas fa-users me-2"></i> Patients</span>
                </a>
                <div id="test1" class="collapse">
                    <div class="collapse-inner">
                        <a href="#" class="collapse-item">All Patients</a>
                        <a href="#" class="collapse-item">Register</a>
                        <a href="#" class="collapse-item">Search</a>
                    </div>
                </div>
            </div>
            
            <div class="nav-item">
                <a class="nav-link" href="#" data-bs-toggle="collapse" data-bs-target="#test2">
                    <span><i class="fas fa-user-md me-2"></i> Doctors</span>
                </a>
                <div id="test2" class="collapse">
                    <div class="collapse-inner">
                        <a href="#" class="collapse-item">All Doctors</a>
                        <a href="#" class="collapse-item">Manage</a>
                    </div>
                </div>
            </div>
            
            <div class="nav-item">
                <a class="nav-link" href="#" data-bs-toggle="collapse" data-bs-target="#test3">
                    <span><i class="fas fa-pills me-2"></i> Pharmacy</span>
                </a>
                <div id="test3" class="collapse">
                    <div class="collapse-inner">
                        <a href="#" class="collapse-item">Prescriptions</a>
                        <a href="#" class="collapse-item">Inventory</a>
                        <a href="#" class="collapse-item">Orders</a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Content Area -->
        <div id="content-wrapper">
            <div class="container-fluid">
                <h2>Verify Sidebar Dropdown Fix</h2>
                
                <div class="status-panel">
                    <h5>Test Results</h5>
                    <div id="test-results">
                        <div class="alert alert-info">
                            Click on dropdowns in the sidebar to test functionality. 
                            The logs below will show what's happening.
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <button class="btn btn-primary btn-test" onclick="runClickTest()">Test Click Handlers</button>
                        <button class="btn btn-secondary btn-test" onclick="runAccordionTest()">Test Accordion Behavior</button>
                        <button class="btn btn-success btn-test" onclick="clearLogs()">Clear Logs</button>
                        <button class="btn btn-info btn-test" onclick="showState()">Show Current State</button>
                    </div>
                    <div class="mt-3">
                        <div class="test-log" id="log-container">Waiting for interaction...</div>
                    </div>
                </div>
                
                <div class="status-panel">
                    <h5>Expected Behavior</h5>
                    <ul>
                        <li>✅ Clicking dropdown should toggle it open/closed</li>
                        <li>✅ Only one dropdown should be open at a time</li>
                        <li>✅ Arrow icons should rotate when expanded</li>
                        <li>✅ All events should be logged here</li>
                        <li>✅ No error messages should appear</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and our sidebar.js -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Load sidebar.js directly from the project -->
    <script>
        // Copy of the fixed sidebar.js code inline for testing
        (function($) {
            "use strict";

            console.log('Sidebar Script Loading...');

            // Logging function
            function log(message, type = 'info') {
                const logContainer = document.getElementById('log-container');
                const timestamp = new Date().toLocaleTimeString();
                const color = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#007bff';
                
                if (logContainer) {
                    logContainer.innerHTML += `<div class="log-entry ${type}" style="color:${color}">[${timestamp}] ${message}</div>`;
                    logContainer.scrollTop = logContainer.scrollHeight;
                }
                console.log(`[${type}]`, message);
            }

            // Main click handler
            function initClickHandlers() {
                log('Initializing click handlers...');
                
                $(document).on('click', '.nav-link[data-bs-toggle="collapse"]', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const $this = $(this);
                    const target = $this.attr('data-bs-target') || $this.attr('href');
                    const $collapse = $(target);
                    
                    log(`Clicked: ${$this.text().trim()}`, 'click');
                    log(`Target: ${target}`, 'click');
                    
                    if ($collapse.length === 0) {
                        log(`ERROR: Target ${target} not found`, 'error');
                        return false;
                    }
                    
                    const isOpen = $collapse.hasClass('show');
                    log(`Is currently open: ${isOpen}`, 'click');
                    
                    if (isOpen) {
                        // Close it
                        log(`Closing ${target}`, 'close');
                        $collapse.collapse('hide');
                    } else {
                        // Close all others first
                        log(`Closing all other dropdowns`, 'info');
                        $('.collapse.show').each(function() {
                            if (this.id !== $collapse.attr('id')) {
                                $(this).collapse('hide');
                                const trigger = $(this).prev('.nav-link');
                                trigger.removeClass('expanded').addClass('collapsed');
                                trigger.attr('aria-expanded', 'false');
                                log(`Closed: ${this.id}`, 'close');
                            }
                        });
                        
                        // Open this one
                        log(`Opening ${target}`, 'open');
                        $collapse.collapse('show');
                    }
                    
                    return false;
                });

                // Bootstrap events for state management
                $(document).on('show.bs.collapse', '.collapse', function() {
                    const $this = $(this);
                    const $trigger = $this.prev('.nav-link');
                    $trigger.removeClass('collapsed').addClass('expanded');
                    $trigger.attr('aria-expanded', 'true');
                    log(`Event: Showing ${this.id}`, 'open');
                });

                $(document).on('hide.bs.collapse', '.collapse', function() {
                    const $this = $(this);
                    const $trigger = $this.prev('.nav-link');
                    $trigger.removeClass('expanded').addClass('collapsed');
                    $trigger.attr('aria-expanded', 'false');
                    log(`Event: Hiding ${this.id}`, 'close');
                });

                $(document).on('shown.bs.collapse', '.collapse', function() {
                    log(`Event: Shown ${this.id} ✓`, 'success');
                });

                $(document).on('hidden.bs.collapse', '.collapse', function() {
                    log(`Event: Hidden ${this.id} ✓`, 'success');
                });
                
                log('Click handlers initialized ✓', 'success');
            }

            // Initialize when ready
            $(document).ready(function() {
                log('Document ready', 'info');
                initClickHandlers();
                log('Sidebar dropdown fix is ACTIVE', 'success');
            });

        })(jQuery);

        // Test functions
        function runClickTest() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<div class="alert alert-warning">Now click the first dropdown in the sidebar (Patients)... check logs below.</div>';
        }

        function runAccordionTest() {
            const logs = document.getElementById('log-container');
            logs.innerHTML = '<div class="log-entry">Testing accordion: Click dropdown 1, then dropdown 2... Dropdown 1 should close automatically.</div>';
        }

        function clearLogs() {
            document.getElementById('log-container').innerHTML = 'Logs cleared...';
        }

        function showState() {
            const open = [];
            $('.collapse').each(function() {
                if ($(this).hasClass('show')) {
                    open.push(this.id);
                }
            });
            const logs = document.getElementById('log-container');
            logs.innerHTML += `<div class="log-entry">Current open dropdowns: ${open.length > 0 ? open.join(', ') : 'None'}</div>`;
        }
    </script>
</body>
</html>
