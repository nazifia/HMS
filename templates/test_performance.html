{% extends 'base.html' %}
{% load static %}

{% block title %}Test HTMX/Alpine.js{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>HTMX & Alpine.js Test Page</h1>
    
    <!-- Basic Alpine.js Test -->
    <div x-data="{ count: 0 }" class="card mb-4">
        <div class="card-body">
            <h3>Alpine.js Counter Test</h3>
            <button @click="count++" class="btn btn-primary">Count: <span x-text="count"></span></button>
            <p x-show="count > 0" class="mt-2">Great! Alpine.js is working!</p>
        </div>
    </div>
    
    <!-- Basic HTMX Test -->
    <div class="card mb-4">
        <div class="card-body">
            <h3>HTMX Test</h3>
            <button 
                hx-get="{% url 'patients:list' %}" 
                hx-target="#htmx-result" 
                hx-indicator=".htmx-indicator"
                class="btn btn-success">
                Load Patient List (Partial)
            </button>
            <div class="htmx-indicator" style="display: none;">
                <i class="fas fa-spinner fa-spin"></i> Loading...
            </div>
            <div id="htmx-result" class="mt-3"></div>
        </div>
    </div>
    
    <!-- Search Test -->
    <div x-data="{
        search: '',
        typing: false,
        timeout: null,
        performSearch() {
            this.typing = true;
            clearTimeout(this.timeout);
            this.timeout = setTimeout(() => {
                this.typing = false;
                if (typeof htmx !== 'undefined') {
                    console.log('HTMX is available');
                } else {
                    console.log('HTMX is not available');
                }
            }, 300);
        }
    }" class="card">
        <div class="card-body">
            <h3>Search Component Test</h3>
            <input 
                type="text" 
                x-model="search" 
                @input.debounce.300ms="performSearch()" 
                class="form-control" 
                placeholder="Type to test...">
            <span x-show="typing" class="text-muted small">Typing...</span>
            <p x-show="search">You typed: <strong x-text="search"></strong></p>
        </div>
    </div>
    
    <!-- Framework Detection -->
    <div class="card mt-4">
        <div class="card-body">
            <h3>Framework Detection</h3>
            <p><strong>Alpine.js:</strong> <span id="alpine-status" class="badge bg-secondary">Checking...</span></p>
            <p><strong>HTMX:</strong> <span id="htmx-status" class="badge bg-secondary">Checking...</span></p>
            <p><strong>Bootstrap:</strong> <span id="bootstrap-status" class="badge bg-secondary">Checking...</span></p>
        </div>
    </div>
</div>

<!-- Modal container for dynamic content -->
<div id="modal-container"></div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Check Alpine.js
    const alpineStatus = document.getElementById('alpine-status');
    if (typeof Alpine !== 'undefined') {
        alpineStatus.textContent = 'Available';
        alpineStatus.className = 'badge bg-success';
    } else {
        alpineStatus.textContent = 'Not Available';
        alpineStatus.className = 'badge bg-danger';
    }

    // Check HTMX
    const htmxStatus = document.getElementById('htmx-status');
    if (typeof htmx !== 'undefined') {
        htmxStatus.textContent = 'Available';
        htmxStatus.className = 'badge bg-success';
    } else {
        htmxStatus.textContent = 'Not Available';
        htmxStatus.className = 'badge bg-danger';
    }

    // Check Bootstrap
    const bootstrapStatus = document.getElementById('bootstrap-status');
    if (typeof bootstrap !== 'undefined') {
        bootstrapStatus.textContent = 'Available';
        bootstrapStatus.className = 'badge bg-success';
    } else {
        bootstrapStatus.textContent = 'Not Available';
        bootstrapStatus.className = 'badge bg-danger';
    }

    // HTMX event listeners
    if (typeof htmx !== 'undefined') {
        htmx.on('htmx:afterRequest', function(evt) {
            console.log('HTMX request completed:', evt);
        });

        htmx.on('htmx:beforeRequest', function(evt) {
            console.log('HTMX request starting:', evt);
        });
    }
});
</script>
{% endblock %}
