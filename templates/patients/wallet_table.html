{% load custom_filters core_tags %}
<div class="table-responsive">
    <table class="table table-bordered table-hover" id="wallets-table">
        <thead>
            <tr>
                <th>Patient</th>
                <th>Patient ID</th>
                <th>Phone</th>
                <th>Type</th>
                <th>Balance</th>
                <th>Last Updated</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for wallet in wallets %}
            <tr>
                <td>
                    <a href="{% url 'patients:detail' wallet.patient.id %}">
                        {{ wallet.patient.get_full_name }}
                    </a>
                </td>
                <td>{{ wallet.patient.patient_id }}</td>
                <td>{{ wallet.patient.phone_number }}</td>
                <td>
                    {% if wallet.patient.is_nhia %}
                    <span class="badge bg-info">NHIA</span>
                    {% elif wallet.patient.is_retainership %}
                    <span class="badge bg-success">Retainership</span>
                    {% else %}
                    <span class="badge bg-secondary">Regular</span>
                    {% endif %}
                </td>
                <td class="{% if wallet.balance > 0 %}text-success{% elif wallet.balance < 0 %}text-danger{% else %}text-warning{% endif %}">
                    <strong>{{ wallet.balance|currency }}</strong>
                </td>
                <td>{{ wallet.last_updated|date:'M d, Y H:i' }}</td>
                <td>
                    <a href="{% url 'patients:wallet_dashboard' wallet.patient.id %}" class="btn btn-sm btn-primary" data-bs-toggle="tooltip" title="View Wallet">
                        <i class="fas fa-eye"></i> View
                    </a>
                    {% if user.is_superuser or user|has_role:'admin' or user|has_role:'accountant' or user|has_role:'receptionist' %}
                        <a href="{% url 'patients:add_funds_to_wallet' wallet.patient.id %}" class="btn btn-sm btn-success" data-bs-toggle="tooltip" title="Add Funds">
                            <i class="fas fa-plus"></i> Add Funds
                        </a>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center py-4">
                    <i class="fas fa-search fa-3x text-gray-300 mb-3"></i>
                    <h5 class="text-gray-500">No wallets found</h5>
                    <p class="text-gray-400">Try adjusting your search criteria.</p>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Results Summary -->
<div class="mt-3">
    <span class="badge bg-primary" id="wallet-count">Total: {{ wallets.count }}</span>
    <span class="badge bg-success">Positive: {{ positive_wallets }}</span>
    <span class="badge bg-warning text-dark">Zero: {{ zero_wallets }}</span>
    <span class="badge bg-danger">Negative: {{ negative_wallets }}</span>
    <span class="badge bg-info">Total Balance: {{ total_balance|currency }}</span>
</div>
