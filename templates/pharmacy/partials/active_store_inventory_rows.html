{% load static %}
{% load custom_filters %}

<!-- Inventory Table Rows - HTMX Partial -->
{% if error %}
    <tr>
        <td colspan="8" class="text-center py-4">
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i>
                {{ error }}
            </div>
        </td>
    </tr>
{% elif inventory_items %}
    {% for item in inventory_items %}
        <tr class="inventory-row" data-medication-name="{{ item.medication.name|lower }}">
            <td>
                <strong>{{ item.medication.name }}</strong>
                {% if item.medication.category %}
                    <br><small class="text-muted">{{ item.medication.category.name }}</small>
                {% endif %}
            </td>
            <td>{{ item.batch_number|default:"-" }}</td>
            <td>
                {% if item.expiry_date %}
                    <span class="{% if item.is_expired %}text-danger{% elif item.expires_soon %}text-warning{% endif %}">
                        {{ item.expiry_date|date:"M d, Y" }}
                    </span>
                {% else %}
                    -
                {% endif %}
            </td>
            <td>
                <span class="fw-bold">{{ item.stock_quantity }}</span>
            </td>
            <td>{{ item.reorder_level }}</td>
            <td>{{ item.unit_cost|currency }}</td>
            <td>
                <strong>{{ item.unit_cost|multiply:item.stock_quantity|currency }}</strong>
            </td>
            <td>
                {% if item.stock_quantity == 0 %}
                    <span class="stock-indicator stock-out"></span>
                    Out of Stock
                {% elif item.stock_quantity <= item.reorder_level %}
                    <span class="stock-indicator stock-low"></span>
                    Low Stock
                {% elif item.stock_quantity <= item.reorder_level|mul:"2" %}
                    <span class="stock-indicator stock-medium"></span>
                    Medium
                {% else %}
                    <span class="stock-indicator stock-high"></span>
                    High Stock
                {% endif %}
            </td>
        </tr>
    {% endfor %}

    <!-- Search Results Info -->
    {% if search_query %}
        <tr>
            <td colspan="8" class="p-3 bg-light border-top">
                <span class="text-muted">
                    <i class="fas fa-search me-2"></i>
                    Showing {{ inventory_items|length }} medication{{ inventory_items|pluralize }} matching "{{ search_query }}"
                </span>
            </td>
        </tr>
    {% endif %}
{% else %}
    <tr>
        <td colspan="8" class="text-center py-4">
            <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
            <p class="text-muted">
                {% if search_query %}
                    No medications found matching "{{ search_query }}".
                {% else %}
                    No inventory items found in this active store.
                {% endif %}
            </p>
        </td>
    </tr>
{% endif %}
