{% load pharmacy_tags %}
{% for item in inventory_items %}
    {% with category_name=item.medication.category.name|default:"No category" %}
    <tr class="{% if item.stock_quantity == 0 %}out-of-stock{% elif item.stock_quantity <= item.reorder_level|default:10 %}low-stock{% endif %}"
        data-medication-name="{{ item.medication.name|lower }}"
        data-generic-name="{{ item.medication.generic_name|lower }}"
        data-category="{{ category_name|lower }}"
        data-stock-status="{% if item.stock_quantity == 0 %}out_of_stock{% elif item.stock_quantity <= item.reorder_level|default:10 %}low_stock{% else %}in_stock{% endif %}">
        <td>
            <strong class="searchable">{{ item.medication.name }}</strong>
            {% if item.medication.generic_name %}
                <br><small class="text-muted searchable">{{ item.medication.generic_name }}</small>
            {% endif %}
        </td>
        <td>
            <span class="searchable">{{ category_name }}</span>
        </td>
        <td>
            <span class="badge {% if item.stock_quantity == 0 %}bg-danger{% elif item.stock_quantity <= item.reorder_level|default:10 %}bg-warning{% else %}bg-success{% endif %}">
                {{ item.stock_quantity }}
            </span>
        </td>
        <td>{{ item.reorder_level|default:10 }}</td>
        <td>
            {% if item.stock_quantity == 0 %}
                <span class="badge bg-danger">Out of Stock</span>
            {% elif item.stock_quantity <= item.reorder_level|default:10 %}
                <span class="badge bg-warning">Low Stock</span>
            {% else %}
                <span class="badge bg-success">In Stock</span>
            {% endif %}
        </td>
        <td>
            {% if item.last_restock_date %}
                {{ item.last_restock_date|date:"M d, Y" }}
            {% else %}
                <span class="text-muted">Never</span>
            {% endif %}
        </td>
    </tr>
    {% endwith %}
{% empty %}
    <tr>
        <td colspan="6" class="text-center text-muted py-4">
            <i class="fas fa-box-open fa-3x mb-3 d-block"></i>
            <p class="mb-0">No inventory items found matching your criteria.</p>
        </td>
    </tr>
{% endfor %}
