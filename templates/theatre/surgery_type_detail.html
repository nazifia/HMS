{% extends 'base.html' %}
{% load custom_filters %}

{% block title %}Surgery Type Details{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">{{ object.name }}</h2>
        </div>
        <div class="card-body">
            <p><strong>Name:</strong> {{ object.name }}</p>
            <p><strong>Category:</strong> {{ object.category }}</p>
            <p><strong>Description:</strong> {{ object.description|default:"No description provided." }}</p>
            
            <hr>
            <h5><i class="fas fa-tools mr-2"></i>Required Equipment</h5>
            {% if object.required_equipment.all %}
                <div class="table-responsive">
                    <table class="table table-sm table-bordered">
                        <thead>
                            <tr>
                                <th>Equipment</th>
                                <th>Type</th>
                                <th>Quantity Required</th>
                                <th>Mandatory</th>
                                <th>Available</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for equip_req in object.required_equipment.all %}
                            <tr>
                                <td>{{ equip_req.equipment.name }}</td>
                                <td>{{ equip_req.equipment.get_equipment_type_display }}</td>
                                <td>{{ equip_req.quantity_required }}</td>
                                <td>
                                    {% if equip_req.is_mandatory %}
                                        <span class="badge bg-danger">Yes</span>
                                    {% else %}
                                        <span class="badge bg-secondary">No</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if equip_req.equipment.is_available and equip_req.equipment.quantity_available >= equip_req.quantity_required %}
                                        <span class="badge bg-success">Yes ({{ equip_req.equipment.quantity_available }})</span>
                                    {% else %}
                                        <span class="badge bg-warning text-dark">No ({{ equip_req.equipment.quantity_available }} available)</span>
                                    {% endif %}
                                </td>
                                <td>{{ equip_req.notes|default:"-" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p class="text-muted">No required equipment defined for this surgery type.</p>
            {% endif %}
        </div>
        <div class="card-footer text-end">
            <a href="{% url 'theatre:surgery_type_update' object.pk %}" class="btn btn-warning">Edit</a>
            <a href="{% url 'theatre:surgery_type_delete' object.pk %}" class="btn btn-danger">Delete</a>
            <a href="{% url 'theatre:surgery_type_list' %}" class="btn btn-secondary">Back to List</a>
            {% if user.is_superuser or user.profile.role == 'admin' %}
            <a href="{% url 'theatre:manage_surgery_type_equipment' object.pk %}" class="btn btn-info">
                <i class="fas fa-tools"></i> Manage Equipment
            </a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}