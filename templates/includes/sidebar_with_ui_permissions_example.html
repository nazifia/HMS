{% comment %}
Example Sidebar Template with UI Permission System
This demonstrates how to use the new UI Permission system in your sidebar navigation.

To use this in your project:
1. Copy the permission checks to your existing sidebar.html
2. Make sure to load the template tag at the top: {% load hms_permissions %}
3. Replace hardcoded role checks with {% if user|can_show_ui:'element_id' %}

Note: This is an EXAMPLE template. Merge it with your existing sidebar.html as needed.
{% endcomment %}

{% load static %}
{% load custom_filters %}
{% load hms_permissions %}

<nav id="sidebar" class="sidebar">
    <div class="sidebar-content">
        <div class="sidebar-header">
            <h3>HMS</h3>
            <p class="text-muted">Hospital Management</p>
        </div>

        <ul class="sidebar-nav">
            <!-- Dashboard - Available to all authenticated users -->
            {% if user|can_show_ui:'menu_dashboard' %}
            <li class="sidebar-item">
                <a class="sidebar-link" href="{% url 'dashboard:dashboard' %}">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            {% endif %}

            <!-- Patient Management -->
            {% if user|can_show_ui:'menu_patients' %}
            <li class="sidebar-item">
                <a class="sidebar-link" href="{% url 'patients:list' %}">
                    <i class="fas fa-user-injured"></i>
                    <span>Patients</span>
                </a>
            </li>
            {% endif %}

            <!-- Appointments -->
            {% if user|can_show_ui:'menu_appointments' %}
            <li class="sidebar-item">
                <a class="sidebar-link" href="{% url 'appointments:list' %}">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Appointments</span>
                </a>
            </li>
            {% endif %}

            <!-- Pharmacy - Only for pharmacists and admins -->
            {% if user|can_show_ui:'menu_pharmacy' %}
            <li class="sidebar-item">
                <a class="sidebar-link" href="#pharmacy-submenu" data-bs-toggle="collapse">
                    <i class="fas fa-pills"></i>
                    <span>Pharmacy</span>
                    <i class="fas fa-chevron-right sidebar-dropdown-icon"></i>
                </a>
                <ul id="pharmacy-submenu" class="sidebar-dropdown list-unstyled collapse">
                    {% if user|can_show_ui:'btn_dispense_medication' %}
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="{% url 'pharmacy:dispense' %}">
                            <i class="fas fa-prescription-bottle"></i> Dispense
                        </a>
                    </li>
                    {% endif %}

                    {% if user|can_show_ui:'btn_manage_inventory' %}
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="{% url 'pharmacy:inventory' %}">
                            <i class="fas fa-boxes"></i> Inventory
                        </a>
                    </li>
                    {% endif %}

                    {% if user|can_show_ui:'section_bulk_store' %}
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="{% url 'pharmacy:bulk_store' %}">
                            <i class="fas fa-warehouse"></i> Bulk Store
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </li>
            {% endif %}

            <!-- Laboratory - For lab technicians and doctors -->
            {% if user|can_show_ui:'menu_laboratory' %}
            <li class="sidebar-item">
                <a class="sidebar-link" href="#laboratory-submenu" data-bs-toggle="collapse">
                    <i class="fas fa-flask"></i>
                    <span>Laboratory</span>
                    <i class="fas fa-chevron-right sidebar-dropdown-icon"></i>
                </a>
                <ul id="laboratory-submenu" class="sidebar-dropdown list-unstyled collapse">
                    {% if user|can_show_ui:'btn_create_test' %}
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="{% url 'laboratory:create_request' %}">
                            <i class="fas fa-plus"></i> New Request
                        </a>
                    </li>
                    {% endif %}

                    {% if user|can_show_ui:'btn_enter_results' %}
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="{% url 'laboratory:enter_results' %}">
                            <i class="fas fa-keyboard"></i> Enter Results
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </li>
            {% endif %}

            <!-- Billing - For accountants and receptionists -->
            {% if user|can_show_ui:'menu_billing' %}
            <li class="sidebar-item">
                <a class="sidebar-link" href="#billing-submenu" data-bs-toggle="collapse">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>Billing</span>
                    <i class="fas fa-chevron-right sidebar-dropdown-icon"></i>
                </a>
                <ul id="billing-submenu" class="sidebar-dropdown list-unstyled collapse">
                    {% if user|can_show_ui:'btn_create_invoice' %}
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="{% url 'billing:create_invoice' %}">
                            <i class="fas fa-plus"></i> Create Invoice
                        </a>
                    </li>
                    {% endif %}

                    {% if user|can_show_ui:'btn_process_payment' %}
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="{% url 'billing:process_payment' %}">
                            <i class="fas fa-money-bill-wave"></i> Process Payment
                        </a>
                    </li>
                    {% endif %}

                    {% if user|can_show_ui:'section_financial_reports' %}
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="{% url 'billing:financial_reports' %}">
                            <i class="fas fa-chart-line"></i> Financial Reports
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </li>
            {% endif %}

            <!-- Reports - Available to most users -->
            {% if user|can_show_ui:'menu_reports' %}
            <li class="sidebar-item">
                <a class="sidebar-link" href="#reports-submenu" data-bs-toggle="collapse">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                    <i class="fas fa-chevron-right sidebar-dropdown-icon"></i>
                </a>
                <ul id="reports-submenu" class="sidebar-dropdown list-unstyled collapse">
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="{% url 'reports:dashboard' %}">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                    </li>

                    {% if user|can_show_ui:'btn_generate_report' %}
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="{% url 'reports:generate' %}">
                            <i class="fas fa-file-export"></i> Generate Report
                        </a>
                    </li>
                    {% endif %}

                    {% if user|can_show_ui:'btn_export_data' %}
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="{% url 'reports:export' %}">
                            <i class="fas fa-download"></i> Export Data
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </li>
            {% endif %}

            <!-- User Management - Only for admins -->
            {% if user|can_show_ui:'menu_users' %}
            <li class="sidebar-item">
                <a class="sidebar-link" href="#admin-submenu" data-bs-toggle="collapse">
                    <i class="fas fa-users"></i>
                    <span>Administration</span>
                    <i class="fas fa-chevron-right sidebar-dropdown-icon"></i>
                </a>
                <ul id="admin-submenu" class="sidebar-dropdown list-unstyled collapse">
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="{% url 'accounts:user_dashboard' %}">
                            <i class="fas fa-users-cog"></i> User Management
                        </a>
                    </li>

                    {% if user|can_show_ui:'btn_manage_roles' %}
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="{% url 'accounts:roles' %}">
                            <i class="fas fa-user-tag"></i> Roles & Permissions
                        </a>
                    </li>
                    {% endif %}

                    <!-- New: UI Permission Management -->
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="{% url 'core:ui_permission_dashboard' %}">
                            <i class="fas fa-shield-alt"></i> UI Permissions
                        </a>
                    </li>
                </ul>
            </li>
            {% endif %}
        </ul>

        <!-- Sidebar Footer -->
        <div class="sidebar-footer">
            <div class="sidebar-user-info">
                <strong>{{ user.get_full_name }}</strong>
                <br>
                <small class="text-muted">
                    {% for role in user.roles.all %}
                        <span class="badge {{ role.name|get_role_badge }}">{{ role.name }}</span>
                    {% endfor %}
                </small>
            </div>
        </div>
    </div>
</nav>

{% comment %}
USAGE NOTES:

1. Old hardcoded check (BEFORE):
   {% if user.is_superuser or user.profile.role == 'pharmacist' %}
       <li><a href="/pharmacy/">Pharmacy</a></li>
   {% endif %}

2. New UI permission check (AFTER):
   {% if user|can_show_ui:'menu_pharmacy' %}
       <li><a href="{% url 'pharmacy:dashboard' %}">Pharmacy</a></li>
   {% endif %}

3. Hybrid approach (TRANSITIONAL):
   {% if user.is_superuser or user|can_show_ui:'menu_pharmacy' %}
       <li><a href="{% url 'pharmacy:dashboard' %}">Pharmacy</a></li>
   {% endif %}

BENEFITS:
- Easy to modify permissions without changing code
- Centralized permission management in admin interface
- Automatically works with new roles created in future
- Better auditing of who can see what
{% endcomment %}
