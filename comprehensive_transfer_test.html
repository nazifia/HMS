<!DOCTYPE html>
<html>
<head>
    <title>Comprehensive Transfer Test</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Comprehensive Transfer Functionality Test</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Medication Inventory</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Medication</th>
                                        <th>Batch</th>
                                        <th>Quantity</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Paracetamol 500mg</td>
                                        <td>BATCH001</td>
                                        <td>100</td>
                                        <td>
                                            <button class="btn btn-primary btn-sm transfer-btn" 
                                                    data-medication="1" 
                                                    data-medication-name="Paracetamol 500mg"
                                                    data-batch="BATCH001"
                                                    data-quantity="100">
                                                Transfer
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Amoxicillin 250mg</td>
                                        <td>BATCH002</td>
                                        <td>50</td>
                                        <td>
                                            <button class="btn btn-primary btn-sm transfer-btn" 
                                                    data-medication="2" 
                                                    data-medication-name="Amoxicillin 250mg"
                                                    data-batch="BATCH002"
                                                    data-quantity="50">
                                                Transfer
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Ibuprofen 200mg</td>
                                        <td>BATCH003</td>
                                        <td>75</td>
                                        <td>
                                            <button class="btn btn-primary btn-sm transfer-btn" 
                                                    data-medication="3" 
                                                    data-medication-name="Ibuprofen 200mg"
                                                    data-batch="BATCH003"
                                                    data-quantity="75">
                                                Transfer
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Transfer Status</h5>
                    </div>
                    <div class="card-body">
                        <div id="status-message" class="alert alert-info">
                            Click a transfer button to begin testing.
                        </div>
                        <div id="transfer-details" class="mt-3">
                            <h6>Transfer Details:</h6>
                            <ul id="details-list" class="list-unstyled">
                                <li>No transfer initiated yet.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Transfer Modal -->
        <div class="modal fade" id="transferModal" tabindex="-1" aria-labelledby="transferModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="transferModalLabel">Transfer Medication</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="transferForm">
                            <input type="hidden" id="medicationId" name="medication_id">
                            <input type="hidden" id="batchNumber" name="batch_number">
                            
                            <div class="mb-3">
                                <label for="medicationName" class="form-label">Medication</label>
                                <input type="text" class="form-control" id="medicationName" readonly>
                            </div>
                            
                            <div class="mb-3">
                                <label for="availableQuantity" class="form-label">Available Quantity</label>
                                <input type="number" class="form-control" id="availableQuantity" readonly>
                            </div>
                            
                            <div class="mb-3">
                                <label for="transferQuantity" class="form-label">Transfer Quantity</label>
                                <input type="number" class="form-control" id="transferQuantity" name="quantity" min="1" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="destination" class="form-label">Destination</label>
                                <input type="text" class="form-control" id="destination" value="Main Dispensary" readonly>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="submitTransfer">Transfer</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            // Update status message
            function updateStatus(message, type = 'info') {
                $('#status-message').removeClass('alert-info alert-success alert-warning alert-danger')
                                   .addClass('alert-' + type)
                                   .html(message);
            }
            
            // Update transfer details
            function updateDetails(details) {
                let detailsHtml = '<ul class="list-unstyled">';
                for (const [key, value] of Object.entries(details)) {
                    detailsHtml += `<li><strong>${key}:</strong> ${value}</li>`;
                }
                detailsHtml += '</ul>';
                $('#details-list').html(detailsHtml);
            }
            
            // Handle transfer button clicks
            $('.transfer-btn').click(function() {
                const medicationId = $(this).data('medication');
                const medicationName = $(this).data('medication-name');
                const batchNumber = $(this).data('batch');
                const availableQuantity = $(this).data('quantity');
                
                // Update status
                updateStatus(`Preparing to transfer ${medicationName}...`, 'info');
                
                // Update transfer details
                updateDetails({
                    'Medication ID': medicationId,
                    'Medication Name': medicationName,
                    'Batch Number': batchNumber,
                    'Available Quantity': availableQuantity
                });
                
                // Populate modal form
                $('#medicationId').val(medicationId);
                $('#medicationName').val(medicationName);
                $('#batchNumber').val(batchNumber);
                $('#availableQuantity').val(availableQuantity);
                $('#transferQuantity').attr('max', availableQuantity).val('');
                
                // Show modal
                const transferModal = new bootstrap.Modal(document.getElementById('transferModal'));
                transferModal.show();
                
                console.log('Transfer button clicked:', {
                    medicationId,
                    medicationName,
                    batchNumber,
                    availableQuantity
                });
            });
            
            // Handle modal shown event
            $('#transferModal').on('shown.bs.modal', function () {
                updateStatus('Transfer modal opened. Please enter transfer quantity.', 'success');
                $('#transferQuantity').focus();
            });
            
            // Handle form submission
            $('#submitTransfer').click(function() {
                const medicationId = $('#medicationId').val();
                const medicationName = $('#medicationName').val();
                const batchNumber = $('#batchNumber').val();
                const availableQuantity = $('#availableQuantity').val();
                const transferQuantity = $('#transferQuantity').val();
                
                if (!transferQuantity || transferQuantity <= 0) {
                    updateStatus('Please enter a valid transfer quantity.', 'warning');
                    return;
                }
                
                if (transferQuantity > availableQuantity) {
                    updateStatus('Transfer quantity cannot exceed available quantity.', 'warning');
                    return;
                }
                
                // Simulate transfer submission
                updateStatus(`Transferring ${transferQuantity} units of ${medicationName}...`, 'info');
                
                // Simulate API call delay
                setTimeout(function() {
                    updateStatus(`Successfully transferred ${transferQuantity} units of ${medicationName} to Main Dispensary!`, 'success');
                    updateDetails({
                        'Medication ID': medicationId,
                        'Medication Name': medicationName,
                        'Batch Number': batchNumber,
                        'Available Quantity': availableQuantity,
                        'Transfer Quantity': transferQuantity,
                        'Destination': 'Main Dispensary',
                        'Status': 'Completed'
                    });
                    
                    // Close modal
                    const transferModal = bootstrap.Modal.getInstance(document.getElementById('transferModal'));
                    transferModal.hide();
                }, 1500);
                
                console.log('Transfer submitted:', {
                    medicationId,
                    medicationName,
                    batchNumber,
                    availableQuantity,
                    transferQuantity
                });
            });
            
            // Handle modal close
            $('#transferModal').on('hidden.bs.modal', function () {
                updateStatus('Transfer modal closed. Click another transfer button to continue.', 'info');
            });
        });
    </script>
</body>
</html>