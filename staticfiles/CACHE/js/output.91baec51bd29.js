(function($){"use strict";function toggleDropdown(dropdownId){const $collapse=$('#'+dropdownId);const $trigger=$collapse.prev('.nav-link');if($collapse.hasClass('show')){closeDropdown($collapse,$trigger);}else{closeAllDropdowns();openDropdown($collapse,$trigger);}
return false;}
function openDropdown($collapse,$trigger){$collapse.collapse('show');$trigger.removeClass('collapsed').addClass('expanded');$trigger.attr('aria-expanded','true');updateDropdownIcon($trigger,true);saveDropdownState($collapse.attr('id'),true);setTimeout(()=>{const sidebar=$('#sidebar-container');const collapseTop=$collapse.offset().top;const sidebarTop=sidebar.offset().top;const sidebarScrollTop=sidebar.scrollTop();const scrollPos=collapseTop-sidebarTop-100;if(scrollPos<0){sidebar.animate({scrollTop:sidebarScrollTop+scrollPos},200);}},50);}
function closeDropdown($collapse,$trigger){$collapse.collapse('hide');$trigger.addClass('collapsed').removeClass('expanded');$trigger.attr('aria-expanded','false');updateDropdownIcon($trigger,false);saveDropdownState($collapse.attr('id'),false);}
function closeAllDropdowns(){$('.sidebar .collapse.show').each(function(){const $collapse=$(this);const $trigger=$collapse.prev('.nav-link');$collapse.collapse('hide');$trigger.addClass('collapsed').removeClass('expanded');$trigger.attr('aria-expanded','false');updateDropdownIcon($trigger,false);saveDropdownState($collapse.attr('id'),false);});}
function updateDropdownIcon($trigger,isOpen){if(isOpen){$trigger.addClass('expanded');$trigger.attr('aria-expanded','true');$trigger.removeClass('collapsed');}else{$trigger.removeClass('expanded');$trigger.attr('aria-expanded','false');$trigger.addClass('collapsed');}
let $icon=$trigger.find('.rotate-icon');if($icon.length>0){$icon.css('transform',isOpen?'rotate(90deg)':'rotate(0deg)');}}
function saveDropdownState(dropdownId,isOpen){try{const states=JSON.parse(localStorage.getItem('sidebarDropdownStates')||'{}');states[dropdownId]=isOpen;localStorage.setItem('sidebarDropdownStates',JSON.stringify(states));}catch(e){console.warn('Could not save dropdown state:',e);}}
function getSavedDropdownStates(){try{return JSON.parse(localStorage.getItem('sidebarDropdownStates')||'{}');}catch(e){return{};}}
function restoreDropdownStates(){const states=getSavedDropdownStates();Object.keys(states).forEach(function(dropdownId){if(states[dropdownId]){const $collapse=$('#'+dropdownId);const $trigger=$collapse.prev('.nav-link');if($collapse.length&&$trigger.length){$collapse.addClass('show');$trigger.removeClass('collapsed').addClass('expanded');$trigger.attr('aria-expanded','true');console.log('Restored dropdown state:',dropdownId,'(open)');}}});}
function toggleMobileSidebar(){const sidebar=$('#sidebar-container');const overlay=$('#sidebar-overlay');const isOpen=sidebar.hasClass('sidebar-open');if(isOpen){closeMobileSidebar();}else{openMobileSidebar();}}
function openMobileSidebar(){const sidebar=$('#sidebar-container');const overlay=$('#sidebar-overlay');sidebar.addClass('sidebar-open');overlay.addClass('active');$('body').addClass('sidebar-open');console.log('Mobile sidebar opened');}
function closeMobileSidebar(){const sidebar=$('#sidebar-container');const overlay=$('#sidebar-overlay');sidebar.removeClass('sidebar-open');overlay.removeClass('active');$('body').removeClass('sidebar-open');console.log('Mobile sidebar closed');}
function toggleDesktopSidebar(){const sidebar=$("#sidebar-container");const isCollapsed=sidebar.hasClass("sidebar-collapsed");$("body").toggleClass("sidebar-toggled");$(".sidebar, #sidebar-container").toggleClass("sidebar-collapsed");const icon=$("#sidebarToggle").find('i');if(isCollapsed){icon.removeClass('fa-angle-right').addClass('fa-angle-left');console.log('Desktop sidebar expanded');}else{icon.removeClass('fa-angle-left').addClass('fa-angle-right');console.log('Desktop sidebar collapsed');}
if(!isCollapsed){closeAllDropdowns();}
saveSidebarState(!isCollapsed);}
function saveSidebarState(isCollapsed){localStorage.setItem('sidebarCollapsed',isCollapsed);}
function getSidebarState(){return localStorage.getItem('sidebarCollapsed')==='true';}
function initKeyboardNavigation(){const $sidebar=$('#accordionSidebar');const $links=$sidebar.find('.nav-link:not([data-bs-toggle="collapse"])');const $dropdownLinks=$sidebar.find('.nav-link[data-bs-toggle="collapse"]');const $collapseItems=$sidebar.find('.collapse-item');$links.on('keydown',function(e){const key=e.key;if(key==='ArrowDown'||key==='ArrowUp'){e.preventDefault();navigateLinks($(this),key==='ArrowDown'?'next':'prev',$links);}});$dropdownLinks.on('keydown',function(e){const key=e.key;const $this=$(this);const $collapse=$($this.attr('href')||$this.data('bs-target'));const isOpen=$collapse.hasClass('show');if(key==='ArrowRight'||key==='ArrowDown'){e.preventDefault();if(!isOpen){$collapse.collapse('show');}
setTimeout(function(){$collapse.find('.collapse-item').first().focus();},100);}else if(key==='ArrowLeft'||key==='ArrowUp'){e.preventDefault();if(isOpen){$collapse.collapse('hide');}}else if(key==='Enter'||key===' '){e.preventDefault();if(isOpen){$collapse.collapse('hide');}else{closeAllDropdowns();$collapse.collapse('show');}}});$collapseItems.on('keydown',function(e){const key=e.key;if(key==='ArrowDown'||key==='ArrowUp'){e.preventDefault();navigateLinks($(this),key==='ArrowDown'?'next':'prev',$collapseItems);}else if(key==='ArrowLeft'||key==='ArrowUp'){e.preventDefault();const $collapse=$(this).closest('.collapse');const $trigger=$collapse.prev('.nav-link');$trigger.focus();}else if(key==='Escape'){e.preventDefault();closeAllDropdowns();}});}
function navigateLinks($current,direction,$allLinks){const index=$allLinks.index($current);let newIndex;if(direction==='next'){newIndex=index<$allLinks.length-1?index+1:0;}else{newIndex=index>0?index-1:$allLinks.length-1;}
$allLinks.eq(newIndex).focus();}
$(document).ready(function(){console.log('Sidebar toggle initialized');$('.sidebar .nav-link[data-bs-toggle="collapse"]').each(function(){const $this=$(this);const $collapse=$this.next('.collapse');const isOpen=$collapse.hasClass('show');if(isOpen){$this.removeClass('collapsed').addClass('expanded');$this.attr('aria-expanded','true');}else{$this.addClass('collapsed').removeClass('expanded');$this.attr('aria-expanded','false');}});$("#sidebarToggle").on('click',function(e){e.preventDefault();toggleDesktopSidebar();});$("#sidebarToggleTop").on('click',function(e){e.preventDefault();toggleMobileSidebar();});$('#sidebar-overlay').on('click',function(){closeMobileSidebar();});$('#mobileSidebarClose').on('click',function(){closeMobileSidebar();});$('.sidebar .nav-link[data-bs-toggle="collapse"]').on('click',function(e){e.preventDefault();e.stopPropagation();const $this=$(this);const target=$this.attr('href')||$this.data('bs-target');const $collapse=$(target);if($collapse.length){const isOpen=$collapse.hasClass('show');if(isOpen){$collapse.collapse('hide');}else{closeAllDropdowns();$collapse.collapse('show');}}
return false;});$('.sidebar .collapse').on('show.bs.collapse',function(){const $thisCollapse=$(this);const $trigger=$thisCollapse.prev('.nav-link');$trigger.removeClass('collapsed').addClass('expanded');$trigger.attr('aria-expanded','true');saveDropdownState($thisCollapse.attr('id'),true);console.log('Opening dropdown:',$thisCollapse.attr('id'));});$('.sidebar .collapse').on('hide.bs.collapse',function(){const $thisCollapse=$(this);const $trigger=$thisCollapse.prev('.nav-link');$trigger.removeClass('expanded').addClass('collapsed');$trigger.attr('aria-expanded','false');saveDropdownState($thisCollapse.attr('id'),false);console.log('Closing dropdown:',$thisCollapse.attr('id'));});$('.sidebar .collapse').on('shown.bs.collapse',function(){const $collapse=$(this);const sidebar=$('#sidebar-container');const collapseTop=$collapse.offset().top;const sidebarTop=sidebar.offset().top;const sidebarScrollTop=sidebar.scrollTop();if(collapseTop<sidebarTop){sidebar.animate({scrollTop:sidebarScrollTop+(collapseTop-sidebarTop)-50},200);}
console.log('Dropdown shown:',$collapse.attr('id'));});$('.sidebar .collapse').on('hidden.bs.collapse',function(){console.log('Dropdown hidden:',$(this).attr('id'));});$('.sidebar .collapse-inner').on('click',function(e){e.stopPropagation();});let resizeTimer;$(window).on('resize',function(){clearTimeout(resizeTimer);resizeTimer=setTimeout(function(){const windowWidth=$(window).width();if(windowWidth>=768){if($('#sidebar-container').hasClass('sidebar-open')){closeMobileSidebar();}}else{closeMobileSidebar();}},250);});initializeSidebarState();restoreDropdownStates();initKeyboardNavigation();$(document).on('keydown',function(e){if(e.key==="Escape"&&$('#sidebar-container').hasClass('sidebar-open')){closeMobileSidebar();}
if(e.key==="Escape"&&$('.sidebar .collapse.show').length>0){closeAllDropdowns();}});$('.sidebar').on('click',function(e){const $target=$(e.target);if($target.is('.sidebar')&&!$target.closest('.nav-link').length&&!$target.closest('.collapse').length){closeAllDropdowns();}});console.log('All sidebar event handlers initialized');});function initializeSidebarState(){const windowWidth=$(window).width();if(windowWidth<768){closeMobileSidebar();console.log('Mobile view: sidebar initialized as closed');}else{const sidebar=$("#sidebar-container");const icon=$("#sidebarToggle").find('i');if(getSidebarState()&&!sidebar.hasClass('sidebar-collapsed')){$("body").addClass("sidebar-toggled");$(".sidebar, #sidebar-container").addClass("sidebar-collapsed");icon.removeClass('fa-angle-left').addClass('fa-angle-right');console.log('Desktop view: sidebar restored as collapsed');}else{console.log('Desktop view: sidebar initialized as expanded');}}}
window.SidebarUtils={toggleDropdown:toggleDropdown,openDropdown:function(dropdownId){const $collapse=$('#'+dropdownId);const $trigger=$collapse.prev('.nav-link');openDropdown($collapse,$trigger);},closeDropdown:function(dropdownId){const $collapse=$('#'+dropdownId);const $trigger=$collapse.prev('.nav-link');closeDropdown($collapse,$trigger);},closeAllDropdowns:closeAllDropdowns,toggleMobileSidebar:toggleMobileSidebar,openMobileSidebar:openMobileSidebar,closeMobileSidebar:closeMobileSidebar,toggleDesktopSidebar:toggleDesktopSidebar,saveSidebarState:saveSidebarState};})(jQuery);;