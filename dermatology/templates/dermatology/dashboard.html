{% extends 'includes/department_dashboard_base.html' %}

{% block department_name %}Dermatology{% endblock %}

{% block department_icon %}
<i class="fas fa-skin"></i>
{% endblock %}

{% block department_description %}
Dermatology Department Dashboard - Manage skin conditions, treatments, and services
{% endblock %}

{% block department_stats %}
<div class="row">
    <!-- Total Records -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-primary shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                            Total Records</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ total_records }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-file-medical fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Records Today -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-success shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                            Records Today</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ records_today }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-calendar-day fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Appointments Today -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-info shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                            Appointments Today</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ appointments_today }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-calendar-check fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Emergency Cases -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-danger shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                            Emergency Cases</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ emergency_cases }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-exclamation-triangle fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Treatment Status Cards -->
<div class="row">
    <!-- Planned Treatments -->
    <div class="col-xl-4 col-md-6 mb-4">
        <div class="card border-left-warning shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                            Planned Treatments</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ pending_treatments }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-clock fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- In Progress Treatments -->
    <div class="col-xl-4 col-md-6 mb-4">
        <div class="card border-left-info shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                            In Progress Treatments</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ in_progress_treatments }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-spinner fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Completed Treatments -->
    <div class="col-xl-4 col-md-6 mb-4">
        <div class="card border-left-success shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                            Completed Treatments</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ completed_treatments }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-check-circle fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Follow-ups Due -->
<div class="row">
    <div class="col-xl-12 col-md-12 mb-4">
        <div class="card border-left-secondary shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-secondary text-uppercase mb-1">
                            Follow-ups Due This Week</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ followups_due }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-bell fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block department_charts %}
<div class="row">
    <!-- Daily Trend Chart -->
    <div class="col-xl-6 col-lg-6">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Daily Records Trend</h6>
            </div>
            <div class="card-body">
                <div class="chart-area">
                    <canvas id="dailyTrendChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Distribution Chart -->
    <div class="col-xl-6 col-lg-6">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Treatment Status Distribution</h6>
            </div>
            <div class="card-body">
                <div class="chart-pie pt-4 pb-2">
                    <canvas id="statusDistributionChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Common Conditions Chart -->
    <div class="col-xl-12 col-lg-12">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Common Skin Conditions</h6>
            </div>
            <div class="card-body">
                <div class="chart-bar">
                    <canvas id="conditionsChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Daily Trend Chart
var dailyTrendCtx = document.getElementById('dailyTrendChart');
var dailyTrendChart = new Chart(dailyTrendCtx, {
    type: 'line',
    data: {
        labels: {{ daily_trend.labels|safe }},
        datasets: [{
            label: 'Records per Day',
            data: {{ daily_trend.data|safe }},
            backgroundColor: 'rgba(78, 115, 223, 0.05)',
            borderColor: 'rgba(78, 115, 223, 1)',
            borderWidth: 2,
            tension: 0.4,
            fill: true
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    precision: 0
                }
            }
        },
        plugins: {
            legend: {
                display: true,
                position: 'bottom'
            }
        }
    }
});

// Status Distribution Chart
var statusDistributionCtx = document.getElementById('statusDistributionChart');
var statusDistributionChart = new Chart(statusDistributionCtx, {
    type: 'doughnut',
    data: {
        labels: {{ status_distribution.labels|safe }},
        datasets: [{
            data: {{ status_distribution.data|safe }},
            backgroundColor: {{ status_distribution.colors|safe }},
            hoverBackgroundColor: ['#5a6268', '#138496', '#218838'],
            hoverBorderColor: 'white'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                display: true,
                position: 'bottom'
            }
        }
    }
});

// Conditions Chart
var conditionsCtx = document.getElementById('conditionsChart');
var conditionsChart = new Chart(conditionsCtx, {
    type: 'bar',
    data: {
        labels: {{ condition_labels|safe }},
        datasets: [{
            label: 'Number of Cases',
            data: {{ condition_counts|safe }},
            backgroundColor: 'rgba(54, 162, 235, 0.7)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    precision: 0
                }
            }
        },
        plugins: {
            legend: {
                display: true,
                position: 'bottom'
            }
        }
    }
});
</script>
{% endblock %}

{% block recent_records_table %}
<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Recent Dermatology Records</h6>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered table-hover" id="dataTable" width="100%" cellspacing="0">
                <thead class="thead-light">
                    <tr>
                        <th>Patient</th>
                        <th>Condition</th>
                        <th>Diagnosis</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for record in recent_records %}
                    <tr>
                        <td>{{ record.patient.get_full_name }}</td>
                        <td>{{ record.get_condition_display }}</td>
                        <td>{{ record.diagnosis|truncatechars:50 }}</td>
                        <td>
                            <span class="badge {% if record.treatment_status == 'completed' %}badge-success{% elif record.treatment_status == 'in_progress' %}badge-info{% else %}badge-warning{% endif %}">
                                {{ record.get_treatment_status_display }}
                            </span>
                        </td>
                        <td>{{ record.created_at|date:"M d, Y H:i" }}</td>
                        <td>
                            <a href="{% url 'dermatology:dermatology_record_detail' record.id %}" class="btn btn-sm btn-primary">
                                <i class="fas fa-eye"></i> View
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center">No recent records found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="mt-3">
            <a href="{% url 'dermatology:dermatology_records' %}" class="btn btn-primary">
                <i class="fas fa-list"></i> View All Records
            </a>
        </div>
    </div>
</div>
{% endblock %}
