{% extends "base.html" %}
{% load static %}

{% block title %}Revenue Analysis Debug{% endblock %}

{% block content %}
<div class="container-fluid">
    <h1>Revenue Analysis Debug Information</h1>
    
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5>Date Range</h5>
                </div>
                <div class="card-body">
                    <p><strong>Start Date:</strong> {{ start_date }}</p>
                    <p><strong>End Date:</strong> {{ end_date }}</p>
                    <p><strong>Days in Period:</strong> {{ performance_metrics.days_in_period }}</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5>Total Revenue</h5>
                </div>
                <div class="card-body">
                    <h2>₦{{ total_revenue|floatformat:2 }}</h2>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5>Department Revenue Breakdown</h5>
                </div>
                <div class="card-body">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Department</th>
                                <th>Revenue</th>
                                <th>Transactions/Payments</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Pharmacy</td>
                                <td>₦{{ pharmacy_revenue.total_revenue|floatformat:2 }}</td>
                                <td>{{ pharmacy_revenue.total_payments }}</td>
                            </tr>
                            <tr>
                                <td>Laboratory</td>
                                <td>₦{{ lab_revenue.total_revenue|floatformat:2 }}</td>
                                <td>{{ lab_revenue.total_payments }}</td>
                            </tr>
                            <tr>
                                <td>Consultations</td>
                                <td>₦{{ consultation_revenue.total_revenue|floatformat:2 }}</td>
                                <td>{{ consultation_revenue.total_payments }}</td>
                            </tr>
                            <tr>
                                <td>Theatre</td>
                                <td>₦{{ theatre_revenue.total_revenue|floatformat:2 }}</td>
                                <td>{{ theatre_revenue.total_payments }}</td>
                            </tr>
                            <tr>
                                <td>Admissions</td>
                                <td>₦{{ admission_revenue.total_revenue|floatformat:2 }}</td>
                                <td>{{ admission_revenue.total_payments }}</td>
                            </tr>
                            <tr>
                                <td>General</td>
                                <td>₦{{ general_revenue.total_revenue|floatformat:2 }}</td>
                                <td>{{ general_revenue.total_payments }}</td>
                            </tr>
                            <tr>
                                <td>Wallet</td>
                                <td>₦{{ wallet_revenue.total_revenue|floatformat:2 }}</td>
                                <td>{{ wallet_revenue.total_transactions }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5>Chart Data (JSON)</h5>
                </div>
                <div class="card-body">
                    <h6>Months:</h6>
                    <pre>{{ chart_data.months|safe }}</pre>
                    
                    <h6>Pharmacy Data:</h6>
                    <pre>{{ chart_data.pharmacy|safe }}</pre>
                    
                    <h6>Laboratory Data:</h6>
                    <pre>{{ chart_data.laboratory|safe }}</pre>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5>Performance Metrics</h5>
                </div>
                <div class="card-body">
                    <p><strong>Total Transactions:</strong> {{ performance_metrics.total_transactions }}</p>
                    <p><strong>Average Transaction Value:</strong> ₦{{ performance_metrics.average_transaction_value|floatformat:2 }}</p>
                    <p><strong>Daily Average:</strong> ₦{{ performance_metrics.daily_average|floatformat:2 }}</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5>Raw Context Data</h5>
                </div>
                <div class="card-body">
                    <h6>Revenue Sources Count:</h6>
                    <p>{{ revenue_sources|length }} sources</p>
                    
                    <h6>Monthly Trends Count:</h6>
                    <p>{{ monthly_trends|length }} months</p>
                    
                    <h6>Filter Form Errors:</h6>
                    {% if filter_form.errors %}
                        <pre>{{ filter_form.errors }}</pre>
                    {% else %}
                        <p>No form errors</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}