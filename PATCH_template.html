\u003c!-- SERVICE SELECTION DROPDOWN PATCH --\u003e
\u003c!-- Insert this code AFTER line 174 (after the Selected Patient card closing div) --\u003e
\u003c!-- and BEFORE the Authorization Code Details comment (before line 176) --\u003e

\u003c!-- Service Selection Field --\u003e
\u003cdiv class=\"row mb-4\"\u003e
\u003cdiv class=\"col-md-12\"\u003e
\u003cdiv class=\"mb-3\"\u003e
\u003clabel for=\"service\" class=\"form-label\"\u003e
\u003ci class=\"fas fa-concierge-bell\"\u003e\u003c/i\u003e Service (Optional)
\u003c/label\u003e
\u003cselect class=\"form-select\" id=\"service\" name=\"service_id\"\u003e
\u003coption value=\"\"\u003e-- No Service Selected --\u003c/option\u003e
{% if services %}
{% for service in services %}
\u003coption value=\"{{ service.id }}\"
data-price=\"{{ service.price }}\"\u003e
{{ service.name }} - â‚¦{{ service.price|floatformat:2 }}
{% if service.category %} ({{ service.category.name }}){% endif %}
\u003c/option\u003e
{% endfor %}
{% else %}
\u003coption value=\"\" disabled\u003eNo active services available\u003c/option\u003e
{% endif %}
\u003c/select\u003e
\u003csmall class=\"form-text text-muted\"\u003e
Select a service to automatically populate the authorization amount
\u003c/small\u003e
\u003c/div\u003e
\u003c/div\u003e
\u003c/div\u003e

\u003c!-- JAVASCRIPT FOR DYNAMIC PRICING --\u003e
\u003c!-- Add this code at the END of the {% block extra_js %} section, --\u003e
\u003c!-- BEFORE the existing updateCodePreview() function or at the very end --\u003e

// Service selection handler for dynamic price updates
document.getElementById('service').addEventListener('change', function() {
const selectedOption = this.options[this.selectedIndex];
const amountField = document.getElementById('amount');

if (selectedOption.value) {
// Get the price from the data attribute
const price = selectedOption.getAttribute('data-price');
if (price) {
amountField.value = parseFloat(price).toFixed(2);
}
} else {
// Clear amount if no service selected
amountField.value = '0.00';
}
});