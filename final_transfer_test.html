<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transfer Button Functionality Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Transfer Button Functionality Test</h1>
        
        <div class="card mb-4">
            <div class="card-header">
                <h5>Current Stock</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Medication</th>
                                <th>Batch Number</th>
                                <th>Expiry Date</th>
                                <th>Stock Quantity</th>
                                <th>Unit Cost</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Paracetamol 500mg</td>
                                <td>BATCH001</td>
                                <td>2026-12-31</td>
                                <td>100</td>
                                <td>10.00</td>
                                <td>
                                    <button type="button" class="btn btn-sm btn-primary transfer-btn" 
                                            data-medication="1"
                                            data-medication-name="Paracetamol 500mg"
                                            data-batch="BATCH001"
                                            data-quantity="100">
                                        Transfer
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>Amoxicillin 250mg</td>
                                <td>BATCH002</td>
                                <td>2025-06-30</td>
                                <td>50</td>
                                <td>15.00</td>
                                <td>
                                    <button type="button" class="btn btn-sm btn-primary transfer-btn" 
                                            data-medication="2"
                                            data-medication-name="Amoxicillin 250mg"
                                            data-batch="BATCH002"
                                            data-quantity="50">
                                        Transfer
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Transfer Modal (Exact copy from template) -->
        <div class="modal fade" id="transferModal" tabindex="-1" role="dialog" aria-labelledby="transferModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="transferModalLabel">Transfer Medication to Dispensary</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form>
                        <div class="modal-body">
                            <input type="hidden" id="medicationId" name="medication_id">
                            <input type="hidden" id="batchNumber" name="batch_number">
                            
                            <div class="form-group mb-3">
                                <label for="medicationName">Medication</label>
                                <input type="text" class="form-control" id="medicationName" readonly>
                            </div>
                            
                            <div class="form-group mb-3">
                                <label for="availableQuantity">Available Quantity</label>
                                <input type="number" class="form-control" id="availableQuantity" readonly>
                            </div>
                            
                            <div class="form-group mb-3">
                                <label for="transferQuantity">Transfer Quantity</label>
                                <input type="number" class="form-control" id="transferQuantity" name="quantity" min="1" required>
                            </div>
                            
                            <div class="form-group mb-3">
                                <label for="dispensary">To Dispensary</label>
                                <input type="text" class="form-control" id="dispensary" value="Main Dispensary" readonly>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">Transfer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h5>Test Results</h5>
            </div>
            <div class="card-body">
                <div id="test-results" class="alert alert-info">
                    Click on a transfer button to test the functionality.
                </div>
                <div id="debug-info" class="mt-3">
                    <h6>Debug Information:</h6>
                    <pre id="debug-output" class="bg-light p-3"></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript for handling transfers (Exact copy from template) -->
    <script>
        $(document).ready(function() {
            // Handle transfer button clicks
            $('.transfer-btn').click(function() {
                var medicationId = $(this).data('medication');
                var medicationName = $(this).data('medication-name');
                var batchNumber = $(this).data('batch');
                var availableQuantity = $(this).data('quantity');
                
                // Debug output
                var debugInfo = {
                    medicationId: medicationId,
                    medicationName: medicationName,
                    batchNumber: batchNumber,
                    availableQuantity: availableQuantity,
                    timestamp: new Date().toISOString()
                };
                
                $('#debug-output').text(JSON.stringify(debugInfo, null, 2));
                
                $('#medicationId').val(medicationId);
                $('#medicationName').val(medicationName);
                $('#batchNumber').val(batchNumber);
                $('#availableQuantity').val(availableQuantity);
                $('#transferQuantity').attr('max', availableQuantity);
                
                // Update test results
                $('#test-results').removeClass('alert-info alert-warning').addClass('alert-success').html(
                    '<strong>Success!</strong> Transfer button clicked and modal should open.<br>' +
                    'Medication: ' + medicationName + '<br>' +
                    'Batch: ' + batchNumber + '<br>' +
                    'Available Quantity: ' + availableQuantity
                );
            });
            
            // Form submission handler
            $('form').submit(function(e) {
                e.preventDefault();
                
                var formData = {
                    medication_id: $('#medicationId').val(),
                    batch_number: $('#batchNumber').val(),
                    quantity: $('#transferQuantity').val(),
                    medication_name: $('#medicationName').val(),
                    available_quantity: $('#availableQuantity').val(),
                    dispensary: $('#dispensary').val()
                };
                
                // Debug output
                $('#debug-output').text(JSON.stringify(formData, null, 2));
                
                // Validate form
                if (!formData.quantity || formData.quantity <= 0) {
                    $('#test-results').removeClass('alert-info alert-success').addClass('alert-warning').html(
                        '<strong>Validation Error!</strong> Please enter a valid transfer quantity.'
                    );
                    return;
                }
                
                if (parseInt(formData.quantity) > parseInt(formData.available_quantity)) {
                    $('#test-results').removeClass('alert-info alert-success').addClass('alert-warning').html(
                        '<strong>Validation Error!</strong> Transfer quantity cannot exceed available quantity.'
                    );
                    return;
                }
                
                // Simulate successful transfer
                $('#test-results').removeClass('alert-info alert-warning').addClass('alert-success').html(
                    '<strong>Transfer Successful!</strong><br>' +
                    'Medication: ' + formData.medication_name + '<br>' +
                    'Batch: ' + formData.batch_number + '<br>' +
                    'Quantity Transferred: ' + formData.quantity + '<br>' +
                    'To Dispensary: ' + formData.dispensary
                );
                
                // Close modal
                var transferModal = bootstrap.Modal.getInstance(document.getElementById('transferModal'));
                if (transferModal) {
                    transferModal.hide();
                }
            });
        });
    </script>
</body>
</html>