<!DOCTYPE html>
<html>
<head>
    <title>Test Authorization Form</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { border: 1px solid #ccc; padding: 15px; margin: 10px 0; }
        .result { background-color: #f0f0f0; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Authorization Form Test</h1>
    
    <div class="test-section">
        <h2>Test Form Submission</h2>
        <p>This test will check if the authorization form submits correctly.</p>
        
        <iframe id="testFrame" style="width:100%; height:600px; border:1px solid #ccc;"></iframe>
        
        <div class="result" id="testResults">
            <h3>Test Results:</h3>
            <ul id="resultsList"></ul>
        </div>
    </div>

    <script>
        const frame = document.getElementById('testFrame');
        const resultsList = document.getElementById('resultsList');
        
        // Load the authorization form
        frame.src = 'http://127.0.0.1:8000/desk-office/generate-code/?patient_id=4406145170';
        
        function addResult(test, status, details) {
            const li = document.createElement('li');
            li.innerHTML = `<strong>${test}:</strong> <span style="color: ${status === 'PASS' ? 'green' : 'red'}">${status}</span> - ${details}`;
            resultsList.appendChild(li);
        }
        
        // Wait for iframe to load
        frame.onload = function() {
            try {
                const frameDoc = frame.contentDocument || frame.contentWindow.document;
                
                // Test 1: Check if form exists
                const form = frameDoc.getElementById('authorization-form');
                if (form) {
                    addResult('Form ID Check', 'PASS', 'Form with ID "authorization-form" found');
                } else {
                    addResult('Form ID Check', 'FAIL', 'Form with ID "authorization-form" not found');
                }
                
                // Test 2: Check if submit button exists
                const submitBtn = frameDoc.querySelector('button[type="submit"]');
                if (submitBtn) {
                    addResult('Submit Button Check', 'PASS', 'Submit button found');
                } else {
                    addResult('Submit Button Check', 'FAIL', 'Submit button not found');
                }
                
                // Test 3: Check form fields
                const fields = ['patient_id', 'service_type', 'amount', 'expiry_date', 'notes'];
                let allFieldsFound = true;
                
                fields.forEach(field => {
                    const fieldElement = frameDoc.querySelector(`[name="${field}"]`);
                    if (fieldElement) {
                        addResult(`Field ${field}`, 'PASS', 'Field found');
                    } else {
                        addResult(`Field ${field}`, 'FAIL', 'Field not found');
                        allFieldsFound = false;
                    }
                });
                
                if (allFieldsFound) {
                    addResult('All Required Fields', 'PASS', 'All required fields are present');
                }
                
            } catch (e) {
                addResult('Cross-Origin Test', 'SKIP', `Cannot access iframe content due to CORS: ${e.message}`);
                addResult('Manual Test Required', 'INFO', 'Please manually test the form at http://127.0.0.1:8000/desk-office/generate-code/?patient_id=4406145170');
            }
        };
    </script>
</body>
</html>
